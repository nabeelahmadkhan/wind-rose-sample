<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Wind Rose Chart with ECharts</title>
    <script src="https://cdn.jsdelivr.net/npm/echarts/dist/echarts.min.js"></script>
    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css"
      rel="stylesheet"
      integrity="sha384-QWTKZyjpPEjISv5WaRU9OFeRpok6YctnYmDr5pNlyT2bRjXh0JMhjY6hW+ALEwIH"
      crossorigin="anonymous"
    />
  </head>
  <body>
    <style>
      * {
        padding: 0;
        margin: 0;
      }
      .header {
        height: 100px;
        width: 100%;
        background-color: antiquewhite;
      }
    </style>
    <nav class="navbar navbar-expand-lg bg-body-tertiary">
      <div class="container">
        <a class="navbar-brand" href="#">
          <img src="./assets/img/topraq_logo.svg" width="180" />
        </a>
        <button
          class="navbar-toggler"
          type="button"
          data-bs-toggle="collapse"
          data-bs-target="#navbarNav"
          aria-controls="navbarNav"
          aria-expanded="false"
          aria-label="Toggle navigation"
        >
          <span class="navbar-toggler-icon"></span>
        </button>
      </div>
    </nav>
    <div class="container mt-3">
      <div class="card card-body shadow">
        <h3>Wind Rose Chart</h3>
        <div class="mt-3 col-2">
          <label for="frequencySelect" class="form-label"
            >Select Frequency</label
          >
          <select class="form-select" id="frequencySelect">
            <option value="hours" selected>Hours</option>
            <option value="percentage">Percentage</option>
          </select>
        </div>
        <div id="main" style="width: 100%; height: 600px"></div>
      </div>
    </div>
    <script>
      var chartDom = document.getElementById("main");
      var myChart = echarts.init(chartDom);

      var data = [
        {
          name: "0.0-0.2 m/s",
          values: [2, 2, 1, 4, 2, 3, 4, 6, 1, 1, 3, 4, 2, 3, 4, 6],
        },
        {
          name: "0.3-1.5 m/s",
          values: [7, 12, 10, 2, 2, 3, 4, 0, 1, 2, 3, 2, 2, 3, 4, 6],
        },
        {
          name: "1.6-3.3 m/s",
          values: [10, 12, 11, 4, 2, 13, 14, 16, 11, 0, 13, 0, 12, 13, 14, 12],
        },
        {
          name: "3.4-5.4 m/s",
          values: [10, 2, 13, 2, 2, 3, 4, 6, 1, 2, 3, 2, 2, 3, 4, 6],
        },
        {
          name: "5.5-7.9 m/s",
          values: [10, 2, 13, 4, 2, 3, 4, 6, 1, 2, 3, 4, 1, 2, 3, 1],
        },
        {
          name: "8.0-10.7 m/s",
          values: [10, 2, 13, 2, 2, 3, 4, 6, 1, 2, 3, 2, 1, 2, 3, 1],
        },
        {
          name: "10.8-13.8 m/s",
          values: [10, 2, 8, 4, 2, 3, 4, 6, 1, 2, 3, 4, 2, 3, 4, 2],
        },
        {
          name: "13.9-17.1 m/s",
          values: [1, 0, 0, 1, 0, 0, 2, 1, 3, 2, 0, 1, 2, 1, 1, 2],
        },
      ];

      function calculatePercentage(data) {
        return data.map((item) => {
          const total = item.values.reduce((sum, val) => sum + val, 0);
          console.log("total", total);
          const percentageValues = item.values.map((val) =>
            val === 0 ? 0 : ((val / total) * 100).toFixed(2)
          );
          return {
            ...item,
            values: percentageValues,
          };
        });
      }

      function getOption(data, unit) {
        return {
          tooltip: {
            trigger: "item",
            formatter: function (params) {
              return (
                params.seriesName +
                "<br/>" +
                "Direction: " +
                params.name +
                "<br/>" +
                "Frequency: " +
                params.value +
                (unit === "hours" ? " hours" : " %")
              );
            },
            textStyle: {
              color: "#000",
            },
          },
          color: [
            "#0033FF", // Mid Blue
            "#3572EF", // Mid Cyan-Blue
            "#5AB2FF", // Mid Cyan
            "#41B06E", // Mid Teal
            "#CCCC00", // Mid Olive
            "#F8DE22", // Mid Goldenrod
            "#FF8F00", // Mid Orange
            "#FF3333", // Mid Red
          ],
          angleAxis: {
            type: "category",
            data: [
              "N",
              "NNE",
              "NE",
              "ENE",
              "E",
              "ESE",
              "SE",
              "SSE",
              "S",
              "SSW",
              "SW",
              "WSW",
              "W",
              "WNW",
              "NW",
              "NNW",
            ],
            boundaryGap: false,
            axisTick: {
              show: false,
            },
            splitLine: {
              show: true,
              lineStyle: {
                color: "#ccc",
              },
            },
            axisLabel: {
              show: true,
              interval: 0,
              color: "#333",
            },
          },
          radiusAxis: {
            min: 0,
            max: unit === "hours" ? "75" : "100",
            z: 10,
            axisLabel: {
              show: true,
              formatter: function (value) {
                return value + (unit === "hours" ? " h" : " %");
              },
            },
            axisTick: {
              show: true,
            },
            axisLine: {
              show: true,
            },
            splitLine: {
              show: true,
              lineStyle: {
                color: "#ccc",
              },
            },
          },
          polar: {},
          series: data.map((item) => ({
            type: "bar",
            data: item.values,
            coordinateSystem: "polar",
            name: item.name,
            stack: "a",
            emphasis: {
              focus: "series",
            },
          })),
          legend: {
            show: true,
            data: data.map((item) => item.name),
            textStyle: {
              color: "#333",
            },
            bottom: -5,
            left: "center",
            right: "center",
          },
        };
      }

      myChart.setOption(getOption(data, "hours"));

      document
        .getElementById("frequencySelect")
        .addEventListener("change", function (e) {
          const unit = e.target.value;
          const updatedData =
            unit === "percentage" ? calculatePercentage(data) : data;
          myChart.setOption(getOption(updatedData, unit));
        });
    </script>
  </body>
</html>
